{% for class in storage_classes %}
---
kind: StorageClass
apiVersion: storage.k8s.io/v1
metadata:
  name: "{{ class.name }}"
  annotations:
    storageclass.kubernetes.io/is-default-class: "{{ class.is_default | default(false) | ternary("true","false") }}"
provisioner: cinder.csi.openstack.org
{% if class.mount_options is defined %}
mountOptions:
{% for option in class.mount_options | default([]) %}
  - "{{ option }}"
{% endfor %}
{% endif %}
{% if class.reclaim_policy is defined %}
reclaimPolicy: "{{ class.reclaim_policy }}"
{% endif %}
{% if class.volume_binding_mode is defined %}
volumeBindingMode: "{{ class.volume_binding_mode }}"
{% endif %}
parameters:
{% for key, value in (class.parameters | default({})).items() %}
  "{{ key }}": "{{ value }}"
{% endfor %}
{% if cinder_topology is defined and cinder_topology is sameas true %}
allowedTopologies:
- matchLabelExpressions:
  - key: topology.cinder.csi.openstack.org/zone
    values:
{% for zone in cinder_topology_zones %}
    - "{{ zone }}"
{% endfor %}
{% endif  %}
allowVolumeExpansion: {{ expand_persistent_volumes }}
{% endfor %}
